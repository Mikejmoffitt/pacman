.segment "CODE"

.macro Load8Rows offset
.local loop
        ldx     #0
loop:
        lda     offset,x
        sta     PPUDATA
        inx
        bne     loop
.endmacro

LoadMapIntoVram:
        ; Load nametable
        ; This will overshoot a little bit and clobber the attribute table,
        ; but that's OK.
        lda     #$20
        sta     PPUADDR
        lda     #$00
        sta     PPUADDR
        Load8Rows Map
        Load8Rows Map+$100
        Load8Rows Map+$200
        Load8Rows Map+$300

        ; Last row has to be written to other nametable
        lda     #$28
        sta     PPUADDR
        lda     #$00
        sta     PPUADDR
        tax
@loop:
        lda     Map+32*30,x
        sta     PPUDATA
        inx
        cpx     #32
        bne     @loop

        ; Clear attribute tables
        lda     #$23
        sta     PPUADDR
        lda     #$c0
        sta     PPUADDR
        lda     #$00
        jsr     ClearAttr
        lda     #$2b
        sta     PPUADDR
        lda     #$c0
        sta     PPUADDR
        jsr     ClearAttr
        rts

ClearAttr:
        ldx     #64
@loop:
        sta     PPUDATA
        dex
        bne     @loop
        rts



Map:
    .byte $00,$00,$84,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$aa,$ab,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$85,$86,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$81,$82,$82,$83,$92,$81,$82,$82,$82,$83,$92,$91,$93,$92,$81,$82,$82,$82,$83,$92,$81,$82,$82,$83,$92,$96,$00,$00
    .byte $00,$00,$94,$95,$91,$80,$80,$93,$92,$91,$80,$80,$80,$93,$92,$91,$93,$92,$91,$80,$80,$80,$93,$92,$91,$80,$80,$93,$95,$96,$00,$00
    .byte $00,$00,$94,$92,$a1,$a2,$a2,$a3,$92,$a1,$a2,$a2,$a2,$a3,$92,$a1,$a3,$92,$a1,$a2,$a2,$a2,$a3,$92,$a1,$a2,$a2,$a3,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$81,$82,$82,$83,$92,$81,$83,$92,$81,$82,$82,$82,$82,$82,$82,$83,$92,$81,$83,$92,$81,$82,$82,$83,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$a1,$a2,$a2,$a3,$92,$91,$93,$92,$a1,$a2,$a2,$8b,$8a,$a2,$a2,$a3,$92,$91,$93,$92,$a1,$a2,$a2,$a3,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$a4,$a5,$a5,$a5,$a5,$83,$92,$91,$9a,$82,$82,$83,$20,$91,$93,$20,$81,$82,$82,$9b,$93,$92,$81,$a5,$a5,$a5,$a5,$a6,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$8a,$a2,$a2,$a3,$20,$a1,$a3,$20,$a1,$a2,$a2,$8b,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$93,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$91,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$93,$20,$87,$88,$8c,$8d,$8d,$8e,$88,$89,$20,$91,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$85,$85,$85,$85,$85,$a3,$92,$a1,$a3,$20,$97,$00,$00,$00,$00,$00,$00,$99,$20,$a1,$a3,$92,$a1,$85,$85,$85,$85,$85,$00,$00
    .byte $00,$20,$20,$20,$20,$20,$20,$20,$92,$20,$20,$20,$97,$00,$00,$00,$00,$00,$00,$99,$20,$20,$20,$92,$20,$20,$20,$20,$20,$20,$20,$00
    .byte $00,$00,$a5,$a5,$a5,$a5,$a5,$83,$92,$81,$83,$20,$97,$00,$00,$00,$00,$00,$00,$99,$20,$81,$83,$92,$81,$a5,$a5,$a5,$a5,$a5,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$93,$20,$a7,$a8,$a8,$a8,$a8,$a8,$a8,$a9,$20,$91,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$93,$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$91,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$00,$00,$00,$00,$00,$94,$92,$91,$93,$20,$81,$82,$82,$82,$82,$82,$82,$83,$20,$91,$93,$92,$96,$00,$00,$00,$00,$00,$00,$00
    .byte $00,$00,$84,$85,$85,$85,$85,$a3,$92,$a1,$a3,$20,$a1,$a2,$a2,$8b,$8a,$a2,$a2,$a3,$20,$a1,$a3,$92,$a1,$85,$85,$85,$85,$86,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$81,$82,$82,$83,$92,$81,$82,$82,$82,$83,$92,$91,$93,$92,$81,$82,$82,$82,$83,$92,$81,$82,$82,$83,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$a1,$a2,$8b,$93,$92,$a1,$a2,$a2,$a2,$a3,$92,$a1,$a3,$92,$a1,$a2,$a2,$a2,$a3,$92,$91,$8a,$a2,$a3,$92,$96,$00,$00
    .byte $00,$00,$94,$95,$92,$92,$91,$93,$92,$92,$92,$92,$92,$92,$92,$20,$20,$92,$92,$92,$92,$92,$92,$92,$91,$93,$92,$92,$95,$96,$00,$00
    .byte $00,$00,$ac,$82,$83,$92,$91,$93,$92,$81,$83,$92,$81,$82,$82,$82,$82,$82,$82,$83,$92,$81,$83,$92,$91,$93,$92,$81,$82,$ad,$00,$00
    .byte $00,$00,$bc,$a2,$a3,$92,$a1,$a3,$92,$91,$93,$92,$a1,$a2,$a2,$8b,$8a,$a2,$a2,$a3,$92,$91,$93,$92,$a1,$a3,$92,$a1,$a2,$bd,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$91,$93,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$81,$82,$82,$82,$82,$9b,$9a,$82,$82,$83,$92,$91,$93,$92,$81,$82,$82,$9b,$9a,$82,$82,$82,$82,$83,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$a1,$a2,$a2,$a2,$a2,$a2,$a2,$a2,$a2,$a3,$92,$a1,$a3,$92,$a1,$a2,$a2,$a2,$a2,$a2,$a2,$a2,$a2,$a3,$92,$96,$00,$00
    .byte $00,$00,$94,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$92,$96,$00,$00
    .byte $00,$00,$a4,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a5,$a6,$00,$00
