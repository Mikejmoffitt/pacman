dasm of Pac-Man: http://web.archive.org/web/20091003171028/http://www.lomont.org/Software/Games/PacMan/PacmanASM.html
dasm of Ms. Pac-Man: http://bartgrantham.com/_projects/mspacman/docs/SJL/mspac.20080621.asm


Scroll bug
----------
Negative scroll values are bad. Rewrite maze loading code not to rely on them, or just implement your status area so you won't need to scroll above 0.


Scroll wrap bug
---------------
When the screen is scrolled all the way down, ghosts at the top of the maze may peek out from the bottom of the screen.


Tunnel wrapping
---------------
I spent about 21-23 frames behind the black when wrapping in tunnels in the arcade version.


Pac-Man's movement algorithm
----------------------------
Here's how the yellow guy moves:
* Pac-Man stays horizontally centered in his tile while moving vertically. If not centered, bump him one pixel toward the center.
* Pac-Man stays vertically centered in his tile while moving horizontally. If not centered, bump him one pixel toward the center.
* When Pac-Man reaches the center of a tile:
** Stop him if the next tile in his path is not enterable.
* When Pac-Man tries to turn:
** Reject the turn if the next tile in his path is not enterable.


Bitfields for motion
--------------------
In the original game, sprites move according to 32-bit bitfields. For each 0, the ghost stays in place; for each 1, the ghost moves a pixel. This is done twice a frame, so a ghost may move up to two pixels per frame. (This may not be exactly right...)

$55555555 = 01010101010101010101010101010101 = Pac-Man's speed on level 1 (1 pixel/frame) / Cruise Elroy 1 on level 1
$6AD56AD5 = 01101010110101010110101011010101 = Pac-Man's speed on level 1 after energizer
$D5556AAA = 11010101010101010110101010101010 = Cruise Elroy 2 on level 1
$55552AAA = 01010101010101010010101010101010 = Ghost speed on level 1
$24922492 = 00100100100100100010010010010010 = Scared ghost speed on level 1
$22222222 = 00100010001000100010001000100010 = Tunnel speed on level 1

Eating a dot causes Pac-Man to stop for one frame; eating an energizer causes him to stop for three frames.


Calculating turns
-----------------
A ghost approaching an intersection will have to choose one of up to three directions to turn. It examines the north, east, south, and west tiles around the intersection (discarding the direction it's coming from) and moves into the one that is closest to the target tile. Which one is closest? Let's suppose we have a ghost moving north and it reaches a three-way intersection (north, east, or west). It scores each of these turns depending on how northish, eastish, or westish the target tile is relative to the intersection. If the target is further east than north or west, turn east; if it's further north than east or west, keep going north; etc.

This should be equivalent to, but much faster and simpler than, computing the Euclidean distance to the target from each tile neighboring the intersection.

Algorithm:

    max_score = -INFINITY
    north_score = ghost_y - target_y
    south_score = -north_score
    west_score = ghost_x - target_x
    east_score = -west_score
    IF can go north
        max_score = north_score
        max_direction = north
    IF can go east AND east_score > max_score
        max_score = east_score
        max_direction = east
    IF can go south
        max_score = south_score
        max_direction = south
    IF can go west
        max_score = west_score
        max_direction = west


Cropping sprites at tunnel edges
--------------------------------
Done by setting sprite priority to background when (and only when) a sprite's X coordinate is too high or too low. Since there are no dots or other BG tiles inside the tunnel, the priority flip will not be visible to the player. At the edges of the tunnel will be black BG tiles (i.e. black as a foreground color); Pac-Man and the ghosts will go behind these tiles and seem to disappear.

Note that there seems to be one full tile off each edge of the screen that Pac-Man can appear (or rather not appear) in. After Pac-Man disappears in one end of the tunnel, there is some time before he comes out the other end.


Flickering
----------
Pac-Man does not flicker.

When the sprite overflow flag is set, cycle the priorities for the ghosts so they all flicker equally.


Things to remember
------------------
Ghosts decide which direction they're going to turn some time before they actually turn. The dossier seems to be saying that the decision is made as soon as the ghost enters the tile *before* the intersection. The in-game evidence suggests they make the turn as soon as they arrive at the intersection (their eyes change direction before the turn, but not while they're a whole tile away).

Ghosts always move left upon exiting the ghost house, unless the ghost was in the house during a mode chance, in which case they will move right.

For some levels, Pac-Man speeds up while energizer is active.
